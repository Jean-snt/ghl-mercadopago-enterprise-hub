<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MercadoPago Enterprise - Centro de Comando NOC</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .status-healthy { color: #10b981; }
        .status-warning { color: #f59e0b; }
        .status-critical { color: #ef4444; }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .metric-card {
            transition: transform 0.2s ease-in-out;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-chart-line text-2xl"></i>
                    <h1 class="text-2xl font-bold">MercadoPago Enterprise NOC</h1>
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                        Centro de Comando
                    </span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="pulse-dot w-3 h-3 bg-green-400 rounded-full"></div>
                        <span class="text-sm">Sistema Operativo</span>
                    </div>
                    <div id="last-update" class="text-sm opacity-75">
                        Actualizando...
                    </div>
                    <button id="refresh-btn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="container mx-auto px-6 py-8">
        
        <!-- Status Overview -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Procesado Hoy -->
            <div class="bg-white rounded-xl p-6 card-shadow metric-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Procesado Hoy</p>
                        <p id="total-today" class="text-3xl font-bold text-gray-900">$0</p>
                        <p class="text-green-600 text-sm mt-1">
                            <i class="fas fa-arrow-up"></i> 
                            <span id="today-trend">+0%</span>
                        </p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Tasa de Éxito -->
            <div class="bg-white rounded-xl p-6 card-shadow metric-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Tasa de Éxito</p>
                        <p id="success-rate" class="text-3xl font-bold text-gray-900">0%</p>
                        <p class="text-blue-600 text-sm mt-1">
                            <i class="fas fa-chart-line"></i> 
                            Últimas 24h
                        </p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-check-circle text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Webhooks Pendientes -->
            <div class="bg-white rounded-xl p-6 card-shadow metric-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Webhooks Pendientes</p>
                        <p id="pending-webhooks" class="text-3xl font-bold text-gray-900">0</p>
                        <p class="text-orange-600 text-sm mt-1">
                            <i class="fas fa-clock"></i> 
                            En cola
                        </p>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="fas fa-hourglass-half text-orange-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Alertas Activas -->
            <div class="bg-white rounded-xl p-6 card-shadow metric-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Alertas Activas</p>
                        <p id="active-alerts" class="text-3xl font-bold text-gray-900">0</p>
                        <p class="text-red-600 text-sm mt-1">
                            <i class="fas fa-exclamation-triangle"></i> 
                            <span id="alert-level">Bajo</span>
                        </p>
                    </div>
                    <div class="bg-red-100 p-3 rounded-full">
                        <i class="fas fa-shield-alt text-red-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Volumen por Hora -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Volumen por Hora</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                        <span class="text-sm text-gray-600">Transacciones</span>
                    </div>
                </div>
                <div class="h-64">
                    <canvas id="hourlyVolumeChart"></canvas>
                </div>
            </div>

            <!-- Ingresos Diarios -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Ingresos Diarios</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                        <span class="text-sm text-gray-600">Últimos 7 días</span>
                    </div>
                </div>
                <div class="h-64">
                    <canvas id="dailyRevenueChart"></canvas>
                </div>
            </div>
        </div>

        <!-- System Health & Security -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- System Health -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Estado del Sistema</h3>
                <div id="system-health" class="space-y-4">
                    <!-- Services will be populated here -->
                </div>
            </div>

            <!-- Security Threats -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Amenazas de Seguridad</h3>
                <div id="security-threats" class="space-y-4">
                    <!-- Threats will be populated here -->
                </div>
            </div>
        </div>

        <!-- Notifications & Integrations -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Notification System Status -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Sistema de Notificaciones</h3>
                    <button id="test-notifications-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
                        <i class="fas fa-paper-plane mr-1"></i>Probar
                    </button>
                </div>
                <div id="notification-status" class="space-y-3">
                    <!-- Notification status will be populated here -->
                </div>
            </div>

            <!-- Integration Status -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Estado de Integraciones</h3>
                <div id="integration-status" class="space-y-3">
                    <!-- Integration status will be populated here -->
                </div>
            </div>
        </div>

        <!-- Transactions by Client -->
        <div class="bg-white rounded-xl p-6 card-shadow mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Top Clientes por Volumen</h3>
            <div class="h-64">
                <canvas id="clientVolumeChart"></canvas>
            </div>
        </div>

        <!-- Real-time Metrics -->
        <div class="bg-white rounded-xl p-6 card-shadow">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Métricas en Tiempo Real</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="realtime-metrics">
                <!-- Real-time metrics will be populated here -->
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 flex items-center space-x-4">
            <div class="loading-spinner"></div>
            <span class="text-gray-700">Cargando datos...</span>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = window.location.origin;
        const API_TOKEN = 'junior123'; // En producción esto vendría de autenticación
        
        // Chart instances
        let hourlyVolumeChart, dailyRevenueChart, clientVolumeChart;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadDashboardData();
            
            // Auto-refresh every 30 seconds
            setInterval(loadDashboardData, 30000);
            
            // Manual refresh button
            document.getElementById('refresh-btn').addEventListener('click', function() {
                loadDashboardData();
            });
        });
        
        async function loadDashboardData() {
            showLoading(true);
            
            try {
                // Load main dashboard data
                const response = await fetch(`${API_BASE}/api/v1/dashboard/overview`, {
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'X-API-KEY': API_TOKEN,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateDashboard(data.data);
                    updateLastRefresh();
                }
                
                // Load real-time metrics
                await loadRealtimeMetrics();
                
                // Load notification status
                await loadNotificationStatus();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showError('Error cargando datos del dashboard');
            } finally {
                showLoading(false);
            }
        }
        
        async function loadRealtimeMetrics() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/dashboard/metrics/realtime`, {
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'X-API-KEY': API_TOKEN,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.status === 'success') {
                        updateRealtimeMetrics(data.data);
                    }
                }
            } catch (error) {
                console.error('Error loading realtime metrics:', error);
            }
        }
        
        function updateDashboard(data) {
            // Update financial metrics
            document.getElementById('total-today').textContent = `$${formatNumber(data.financials.total_processed_today)}`;
            document.getElementById('success-rate').textContent = `${data.performance.payment_success_rate}%`;
            
            // Update system health
            updateSystemHealth(data.system_health);
            
            // Update security threats
            updateSecurityThreats(data.security);
            
            // Update charts
            updateHourlyVolumeChart(data.trends.hourly_volume);
            updateDailyRevenueChart(data.trends.daily_revenue);
            updateClientVolumeChart(data.performance.transactions_per_client);
            
            // Update status indicators
            updateStatusIndicators(data);
        }
        
        function updateSystemHealth(healthData) {
            const container = document.getElementById('system-health');
            container.innerHTML = '';
            
            healthData.services.forEach(service => {
                const statusClass = getStatusClass(service.status);
                const statusIcon = getStatusIcon(service.status);
                
                const serviceElement = document.createElement('div');
                serviceElement.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                serviceElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="fas ${statusIcon} ${statusClass}"></i>
                        <div>
                            <p class="font-medium text-gray-900">${service.name}</p>
                            <p class="text-sm text-gray-500">
                                ${service.response_time_ms ? `${service.response_time_ms}ms` : 'N/A'}
                                ${service.uptime_percentage ? `• ${service.uptime_percentage}% uptime` : ''}
                            </p>
                        </div>
                    </div>
                    <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusBadgeClass(service.status)}">
                        ${service.status.toUpperCase()}
                    </span>
                `;
                container.appendChild(serviceElement);
            });
        }
        
        function updateSecurityThreats(securityData) {
            const container = document.getElementById('security-threats');
            container.innerHTML = '';
            
            if (securityData.top_threats.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-shield-check text-4xl text-green-500 mb-2"></i>
                        <p>No hay amenazas detectadas</p>
                    </div>
                `;
                return;
            }
            
            securityData.top_threats.forEach(threat => {
                const severityClass = getSeverityClass(threat.severity);
                const severityIcon = getSeverityIcon(threat.severity);
                
                const threatElement = document.createElement('div');
                threatElement.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                threatElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="fas ${severityIcon} ${severityClass}"></i>
                        <div>
                            <p class="font-medium text-gray-900">${threat.description}</p>
                            <p class="text-sm text-gray-500">${threat.count} ocurrencias</p>
                        </div>
                    </div>
                    <span class="px-2 py-1 text-xs font-medium rounded-full ${getSeverityBadgeClass(threat.severity)}">
                        ${threat.severity}
                    </span>
                `;
                container.appendChild(threatElement);
            });
        }
        
        function updateRealtimeMetrics(metricsData) {
            const container = document.getElementById('realtime-metrics');
            container.innerHTML = '';
            
            Object.entries(metricsData).forEach(([key, metric]) => {
                const metricElement = document.createElement('div');
                metricElement.className = 'bg-gray-50 rounded-lg p-4 text-center';
                metricElement.innerHTML = `
                    <p class="text-sm text-gray-600 mb-1">${formatMetricName(key)}</p>
                    <p class="text-2xl font-bold text-gray-900">${formatMetricValue(metric.value, metric.unit)}</p>
                    <p class="text-xs text-gray-500">${metric.unit}</p>
                `;
                container.appendChild(metricElement);
            });
        }
        
        function initializeCharts() {
            // Hourly Volume Chart
            const hourlyCtx = document.getElementById('hourlyVolumeChart').getContext('2d');
            hourlyVolumeChart = new Chart(hourlyCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Transacciones',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Daily Revenue Chart
            const dailyCtx = document.getElementById('dailyRevenueChart').getContext('2d');
            dailyRevenueChart = new Chart(dailyCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Ingresos',
                        data: [],
                        backgroundColor: '#10b981',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + formatNumber(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Client Volume Chart
            const clientCtx = document.getElementById('clientVolumeChart').getContext('2d');
            clientVolumeChart = new Chart(clientCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
                            '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#6b7280'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        function updateHourlyVolumeChart(data) {
            const labels = data.map(item => {
                const date = new Date(item.hour);
                return date.getHours() + ':00';
            });
            const values = data.map(item => item.count);
            
            hourlyVolumeChart.data.labels = labels;
            hourlyVolumeChart.data.datasets[0].data = values;
            hourlyVolumeChart.update();
        }
        
        function updateDailyRevenueChart(data) {
            const labels = data.map(item => {
                const date = new Date(item.date);
                return date.toLocaleDateString('es-ES', { month: 'short', day: 'numeric' });
            });
            const values = data.map(item => item.revenue);
            
            dailyRevenueChart.data.labels = labels;
            dailyRevenueChart.data.datasets[0].data = values;
            dailyRevenueChart.update();
        }
        
        function updateClientVolumeChart(data) {
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            clientVolumeChart.data.labels = labels;
            clientVolumeChart.data.datasets[0].data = values;
            clientVolumeChart.update();
        }
        
        function updateStatusIndicators(data) {
            // Update pending webhooks
            const pendingWebhooks = data.system_health.services.find(s => s.name === 'Webhook Processing');
            if (pendingWebhooks) {
                document.getElementById('pending-webhooks').textContent = 
                    pendingWebhooks.error_message ? pendingWebhooks.error_message.match(/\d+/) || '0' : '0';
            }
            
            // Update active alerts
            document.getElementById('active-alerts').textContent = data.security.top_threats.length;
            document.getElementById('alert-level').textContent = 
                data.security.threat_level === 'high' ? 'Alto' : 
                data.security.threat_level === 'medium' ? 'Medio' : 'Bajo';
        }
        
        function updateLastRefresh() {
            const now = new Date();
            document.getElementById('last-update').textContent = 
                `Actualizado: ${now.toLocaleTimeString('es-ES')}`;
        }
        
        // Utility functions
        function formatNumber(num) {
            return new Intl.NumberFormat('es-ES').format(num);
        }
        
        function formatMetricName(key) {
            const names = {
                'payments_per_minute': 'Pagos/min',
                'avg_payment_amount': 'Monto Promedio',
                'webhook_queue_size': 'Cola Webhooks',
                'active_sessions': 'Sesiones Activas'
            };
            return names[key] || key;
        }
        
        function formatMetricValue(value, unit) {
            if (unit === 'USD') {
                return '$' + formatNumber(value);
            }
            return formatNumber(value);
        }
        
        function getStatusClass(status) {
            switch (status) {
                case 'healthy': return 'status-healthy';
                case 'degraded': return 'status-warning';
                case 'down': return 'status-critical';
                default: return 'text-gray-500';
            }
        }
        
        function getStatusIcon(status) {
            switch (status) {
                case 'healthy': return 'fa-check-circle';
                case 'degraded': return 'fa-exclamation-triangle';
                case 'down': return 'fa-times-circle';
                default: return 'fa-question-circle';
            }
        }
        
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'healthy': return 'bg-green-100 text-green-800';
                case 'degraded': return 'bg-yellow-100 text-yellow-800';
                case 'down': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }
        
        function getSeverityClass(severity) {
            switch (severity.toLowerCase()) {
                case 'critical': return 'status-critical';
                case 'high': return 'status-critical';
                case 'medium': return 'status-warning';
                case 'low': return 'status-healthy';
                default: return 'text-gray-500';
            }
        }
        
        function getSeverityIcon(severity) {
            switch (severity.toLowerCase()) {
                case 'critical': return 'fa-exclamation-circle';
                case 'high': return 'fa-exclamation-triangle';
                case 'medium': return 'fa-info-circle';
                case 'low': return 'fa-check-circle';
                default: return 'fa-question-circle';
            }
        }
        
        function getSeverityBadgeClass(severity) {
            switch (severity.toLowerCase()) {
                case 'critical': return 'bg-red-100 text-red-800';
                case 'high': return 'bg-red-100 text-red-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'low': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }
        
        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            overlay.classList.toggle('hidden', !show);
        }
        
        function showError(message) {
            // Simple error notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 10 seconds for errors
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 10000);
            
            // Log error to console for debugging
            console.error('Dashboard Error:', message);
        }
        
        // Add success notification function
        function showSuccess(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-check-circle"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        // Notification System Functions
        async function loadNotificationStatus() {
            try {
                const response = await fetch(`${API_BASE}/admin/notification-config`, {
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateNotificationStatus(data.config);
                } else {
                    updateNotificationStatus(null);
                }
            } catch (error) {
                console.error('Error loading notification status:', error);
                updateNotificationStatus(null);
            }
        }

        function updateNotificationStatus(config) {
            const container = document.getElementById('notification-status');
            
            if (!config) {
                container.innerHTML = `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-exclamation-triangle text-yellow-500"></i>
                            <span class="text-gray-700">Sistema de notificaciones no disponible</span>
                        </div>
                        <span class="px-2 py-1 bg-gray-200 text-gray-600 rounded text-xs">OFFLINE</span>
                    </div>
                `;
                return;
            }

            const channels = [
                {
                    name: 'Slack',
                    icon: 'fab fa-slack',
                    enabled: config.slack_configured,
                    details: config.slack_configured ? `Canal: ${config.slack_channel}` : 'No configurado'
                },
                {
                    name: 'Email',
                    icon: 'fas fa-envelope',
                    enabled: config.email_configured,
                    details: config.email_configured ? `${config.to_emails_count} destinatarios` : 'No configurado'
                },
                {
                    name: 'Webhooks',
                    icon: 'fas fa-link',
                    enabled: config.webhooks_configured,
                    details: config.webhooks_configured ? `${config.webhook_urls_count} endpoints` : 'No configurado'
                }
            ];

            container.innerHTML = channels.map(channel => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <i class="${channel.icon} ${channel.enabled ? 'text-green-500' : 'text-gray-400'}"></i>
                        <div>
                            <span class="text-gray-700 font-medium">${channel.name}</span>
                            <p class="text-xs text-gray-500">${channel.details}</p>
                        </div>
                    </div>
                    <span class="px-2 py-1 ${channel.enabled ? 'bg-green-100 text-green-600' : 'bg-gray-200 text-gray-600'} rounded text-xs">
                        ${channel.enabled ? 'ACTIVO' : 'INACTIVO'}
                    </span>
                </div>
            `).join('');

            // Add configuration summary
            const summaryHtml = `
                <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-blue-700">Prioridad mínima: <strong>${config.min_priority}</strong></span>
                        <span class="text-blue-700">Rate limit: <strong>${config.rate_limit_minutes}min</strong></span>
                    </div>
                </div>
            `;
            
            container.innerHTML += summaryHtml;
        }

        async function testNotifications() {
            const button = document.getElementById('test-notifications-btn');
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Enviando...';
            button.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/admin/test-notifications?notification_type=test`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess(`Notificación enviada por ${data.result.channels?.length || 0} canales`);
                } else {
                    showError('Error enviando notificación de prueba');
                }
            } catch (error) {
                console.error('Error testing notifications:', error);
                showError('Error probando notificaciones');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // Add event listener for test notifications button
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing code ...
            
            // Add notification test button listener
            const testBtn = document.getElementById('test-notifications-btn');
            if (testBtn) {
                testBtn.addEventListener('click', testNotifications);
            }
        });
    </script>
</body>
</html>